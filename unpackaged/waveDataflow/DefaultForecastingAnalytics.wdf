{"nodes":{"GenerateGroupByColumn_FirstDay":{"action":"computeExpression","parameters":{"computedFields":[{"label":"GroupBy_FirstDay","name":"GroupBy_FirstDay","saqlExpression":"ParentId+\"_\"+AsOfDate_FirstDay","type":"Text"}],"mergeWithSource":true},"sources":["RemoveOriginalAmountColumns_FirstDay"]},"PrepareForecastingPrediction":{"action":"computeExpression","parameters":{"computedFields":[{"format":"yyyy-MM-dd","label":"Date","name":"Date","saqlExpression":"toDate('Period.EndDate', \"yyyy-MM-dd\")","type":"Date"},{"label":"Value","name":"Value","precision":18,"saqlExpression":"Amount","scale":5,"type":"Numeric"},{"label":"Type","name":"Type","saqlExpression":"\"Prediction\"","type":"Text"},{"label":"Period_ID","name":"Period_ID","saqlExpression":"PeriodId","type":"Text"},{"label":"ForecastingType_ID","name":"ForecastingType_ID","saqlExpression":"ForecastingTypeId","type":"Text"},{"label":"Owner_ID","name":"Owner_ID","saqlExpression":"ForecastOwnerId","type":"Text"},{"label":"Category","name":"Category","saqlExpression":"\"Prediction\"","type":"Text"},{"label":"ValueLowerBound","name":"ValueLowerBound","precision":18,"saqlExpression":"AmountLowerBound","scale":5,"type":"Numeric"},{"label":"ValueHigherBound","name":"ValueHigherBound","precision":18,"saqlExpression":"AmountHigherBound","scale":5,"type":"Numeric"}],"mergeWithSource":false},"sources":["join(ForecastingPrediction, Period)"]},"Register_Period":{"action":"register","parameters":{"label":"Period","name":"Period"},"sources":["Extract_Period"]},"RemoveFirstCreatedDateColumn_FirstDay":{"action":"sliceDataset","parameters":{"fields":[{"name":"FirstCreatedDate_FirstDay"},{"name":"IsSameCreatedDate_FirstDay"}],"mode":"drop"},"sources":["filterFirstDayOfMonth_FirstDay"]},"join(ForecastingPrediction, Period)":{"action":"augment","parameters":{"leftKey":["PeriodId"],"operation":"LookupSingleValue","relationship":"Period","rightKey":["Id"],"rightSelect":["EndDate"]},"sources":["Extract_ForecastingPrediction","Extract_Period"]},"PrepareForecastingItem":{"action":"append","parameters":{},"sources":["NormalizeAmountWithoutManagerAdjustment","NormalizeForecastAmount"]},"Extract_Users":{"action":"sobjectDigest","parameters":{"fields":[{"name":"Id"},{"name":"Username"},{"name":"Name"},{"name":"FirstName"},{"name":"LastName"},{"name":"UserRoleId"},{"name":"FullPhotoUrl"},{"name":"SmallPhotoUrl"},{"name":"ForecastEnabled"}],"filterConditions":[{"field":"ForecastEnabled","operator":"=","value":"true"}],"object":"User","runtime":{"SFDCtoken":"SFDCtoken"}}},"RemoveOriginalAmountColumns_FirstDay":{"action":"sliceDataset","parameters":{"fields":[{"name":"AmountWithoutManagerAdjustment__hst"},{"name":"ForecastAmount__hst"}],"mode":"drop"},"sources":["append_ForecastingItemHistory_FirstDayOfMonth_FirstDay"]},"Register_Users":{"action":"register","parameters":{"label":"User","name":"User"},"sources":["join(User,MgrRole)"]},"filterOneItemHistoryPerDay_FirstDay":{"action":"filter","parameters":{"filter":"IsSameCreatedDate_FirstDay:EQ:true"},"sources":["CompareLastCreatedDate_FirstDay"]},"join(User,MgrRole)":{"action":"augment","parameters":{"leftKey":["Role.ParentRoleId"],"operation":"LookupSingleValue","relationship":"MgrRole","rightKey":["Id"],"rightSelect":["ForecastUserId"]},"sources":["join(Users,UserRole)","Extract_UserRole"]},"RemoveLastCreatedDateColumn_FirstDay":{"action":"sliceDataset","parameters":{"fields":[{"name":"EarliestCreatedDate_FirstDay"},{"name":"GroupBy_FirstDay"},{"name":"LastCreatedDate_FirstDay"},{"name":"IsSameCreatedDate_FirstDay"},{"name":"CreatedDate"}],"mode":"drop"},"sources":["filterOneItemHistoryPerDay_FirstDay"]},"GroupItemHistoryPerDay_FirstDay":{"action":"computeRelative","parameters":{"computedFields":[{"expression":{"offset":"first()","sourceField":"EarliestCreatedDate_FirstDay","default":"current()"},"label":"LastCreatedDate_FirstDay","name":"LastCreatedDate_FirstDay"}],"orderBy":[{"direction":"desc","name":"EarliestCreatedDate_FirstDay"}],"partitionBy":["GroupBy_FirstDay"]},"sources":["GenerateGroupByColumn_FirstDay"]},"Extract_ForecastingItemHistory":{"action":"sobjectDigest","parameters":{"fields":[{"name":"AmountWithoutManagerAdjustment__hst"},{"name":"CreatedDate"},{"name":"ForecastAmount__hst"},{"name":"Id"},{"name":"ParentId"}],"object":"ForecastingItem__hd"}},"join(ForecastingDataWithFlattenForecastHierarchy,ForecastingType)":{"action":"augment","parameters":{"leftKey":["ForecastingType_ID"],"relationship":"Type","rightKey":["Id"],"rightSelect":["DeveloperName"]},"sources":["join(ForecastingDataWithFlattenForecastHierarchy)","Extract_ForecastingType"]},"join(ForecastingDataWithFlattenForecastHierarchy)":{"action":"augment","parameters":{"leftKey":["Owner_ID"],"operation":"LookupSingleValue","relationship":"Manager","rightKey":["Id"],"rightSelect":["Name","UserRoleId","Managers"]},"sources":["appendAllForecastingData","flatten(ForecastHierarchy)"]},"join(Users,UserRole)":{"action":"augment","parameters":{"leftKey":["UserRoleId"],"operation":"LookupSingleValue","relationship":"Role","rightKey":["Id"],"rightSelect":["ParentRoleId","ForecastUserId"]},"sources":["Extract_Users","Extract_UserRole"]},"Register_ForecastingData":{"action":"register","parameters":{"label":"ForecastingData","name":"ForecastingData","rowLevelSecurityFilter":"('Owner_ID' == \"$User.Id\" && ('Type' != \"ForecastAmount\")) || 'Manager.Managers' == \"$User.Id\"","runtime":{"SFDCtoken":"SFDCtoken"}},"sources":["join(ForecastingDataWithFlattenForecastHierarchy,ForecastingType)"]},"join(ForecastingItemHistory,ForecastingItem,Period)":{"action":"augment","parameters":{"leftKey":["ParentId"],"operation":"LookupSingleValue","relationship":"Parent","rightKey":["Id"],"rightSelect":["ForecastingItemCategory","OwnerId","PeriodId","ForecastingTypeId","PeriodId.EndDate","PeriodId.StartDate"]},"sources":["Extract_ForecastingItemHistory","join(ForecastingItem, Period)"]},"GenerateAsOfDateColumn_FirstDay":{"action":"computeExpression","parameters":{"computedFields":[{"format":"yyyy-MM-dd","label":"AsOfDate_FirstDay","name":"AsOfDate_FirstDay","saqlExpression":"case when toDate(CreatedDate_Year+\"-\"+CreatedDate_Month+\"-\"+CreatedDate_Day,\"yyyy-MM-dd\") < toDate('Parent.PeriodId.StartDate',\"yyyy-MM-dd\") then toDate('Parent.PeriodId.StartDate',\"yyyy-MM-dd\") else toDate(CreatedDate_Year+\"-\"+CreatedDate_Month+\"-\"+CreatedDate_Day,\"yyyy-MM-dd\")  end","type":"Date"},{"format":"yyyy-MM-dd HH:mm:ss","label":"EarliestCreatedDate_FirstDay","name":"EarliestCreatedDate_FirstDay","saqlExpression":"toDate(CreatedDate_Year+\"-\"+CreatedDate_Month+\"-\"+CreatedDate_Day+\" \"+CreatedDate_Hour+\":\"+CreatedDate_Minute+\":\"+CreatedDate_Second,\"yyyy-MM-dd HH:mm:ss\")","type":"Date"},{"label":"ForecastAmount_hst","name":"ForecastAmount_hst","precision":18,"saqlExpression":"ForecastAmount__hst","scale":5,"type":"Numeric"},{"label":"AmountWithoutManagerAdjustment_hst","name":"AmountWithoutManagerAdjustment_hst","precision":18,"saqlExpression":"AmountWithoutManagerAdjustment__hst","scale":5,"type":"Numeric"}],"mergeWithSource":true},"sources":["join(ForecastingItemHistory,ForecastingItem,Period)"]},"Extract_ForecastingPrediction":{"action":"sobjectDigest","parameters":{"fields":[{"name":"Amount"},{"name":"ForecastOwnerId"},{"name":"ForecastingTypeId"},{"name":"PeriodId"},{"name":"AmountHigherBound"},{"name":"AmountLowerBound"}],"object":"ForecastingPrediction"}},"filterFirstDayOfMonth_FirstDay":{"action":"filter","parameters":{"filter":"IsSameCreatedDate_FirstDay:EQ:true"},"sources":["CompareFirstCreatedDate_FirstDay"]},"CompareLastCreatedDate_FirstDay":{"action":"computeExpression","parameters":{"computedFields":[{"defaultValue":"\"false\"","label":"IsSameCreatedDate_FirstDay","name":"IsSameCreatedDate_FirstDay","saqlExpression":"case when EarliestCreatedDate_FirstDay == LastCreatedDate_FirstDay then \"true\" else \"false\" end","type":"Text"}],"mergeWithSource":true},"sources":["GroupItemHistoryPerDay_FirstDay"]},"join(ForecastingItem, Period)":{"action":"augment","parameters":{"leftKey":["PeriodId"],"operation":"LookupSingleValue","relationship":"PeriodId","rightKey":["Id"],"rightSelect":["EndDate","StartDate"]},"sources":["Extract_ForecastingItem","Extract_Period"]},"appendAllForecastingData":{"action":"append","parameters":{},"sources":["PrepareForecastingItem","PreparePredictionTrend","PrepareForecastingPrediction"]},"CompareFirstCreatedDate_FirstDay":{"action":"computeExpression","parameters":{"computedFields":[{"defaultValue":"\"false\"","label":"IsSameCreatedDate_FirstDay","name":"IsSameCreatedDate_FirstDay","saqlExpression":"case when CreatedDate == FirstCreatedDate_FirstDay then \"true\" else \"false\" end","type":"Text"}],"mergeWithSource":true},"sources":["GenerateFirstCreatedDateColumn_FirstDay"]},"NormalizeFirstDayOfMonth_FirstDay":{"action":"computeExpression","parameters":{"computedFields":[{"format":"yyyy-MM-dd HH:mm:ss","label":"EarliestCreatedDate_FirstDay","name":"EarliestCreatedDate_FirstDay","saqlExpression":"toDate(\"1900-01-01 00:00:00\",\"yyyy-MM-dd HH:mm:ss\")","type":"Date"},{"label":"AmountWithoutManagerAdjustment_hst","name":"AmountWithoutManagerAdjustment_hst","precision":18,"saqlExpression":"0","scale":5,"type":"Numeric"},{"label":"ForecastAmount_hst","name":"ForecastAmount_hst","precision":18,"saqlExpression":"0","scale":5,"type":"Numeric"}],"mergeWithSource":true},"sources":["filterOutDaysBeforeHTEnablement_FirstDay"]},"Extract_ForecastingItem":{"action":"sobjectDigest","parameters":{"fields":[{"name":"Id"},{"name":"AmountWithoutManagerAdjustment"},{"name":"ForecastAmount"},{"name":"ForecastingItemCategory"},{"name":"OwnerId"},{"name":"PeriodId"},{"name":"ForecastingTypeId"}],"object":"ForecastingItem","runtime":{"SFDCtoken":"SFDCtoken"}}},"Extract_Period":{"action":"sobjectDigest","parameters":{"fields":[{"name":"EndDate"},{"name":"Id"},{"name":"FullyQualifiedLabel"},{"name":"StartDate"},{"name":"Type"}],"object":"Period"}},"append_ForecastingItemHistory_FirstDayOfMonth_FirstDay":{"action":"append","parameters":{},"sources":["GenerateAsOfDateColumn_FirstDay","NormalizeFirstDayOfMonth_FirstDay"]},"flatten(ForecastHierarchy)":{"action":"flatten","parameters":{"includeSelfId":false,"multiField":{"isSystemField":false,"label":"Managers","name":"Managers"},"parentField":"MgrRole.ForecastUserId","pathField":{"isSystemField":false,"label":"ManagerPath","name":"ManagerPath"},"selfField":"Id"},"sources":["join(User,MgrRole)"]},"Extract_ForecastingPredictionTrend":{"action":"sobjectDigest","parameters":{"fields":[{"name":"Amount"},{"name":"ForecastingPredictionTrendType"},{"name":"PeriodId"},{"name":"AsOfDate"},{"name":"ForecastingTypeId"},{"name":"ForecastOwnerId"},{"name":"AmountHigherBound"},{"name":"AmountLowerBound"}],"object":"ForecastingPredictionTrend"}},"GenerateFirstCreatedDateColumn_FirstDay":{"action":"computeRelative","parameters":{"computedFields":[{"expression":{"offset":"first()","sourceField":"Parent.PeriodId.StartDate","default":"current()"},"label":"AsOfDate_FirstDay","name":"AsOfDate_FirstDay"},{"expression":{"offset":"first()","sourceField":"CreatedDate","default":"current()"},"label":"FirstCreatedDate_FirstDay","name":"FirstCreatedDate_FirstDay"}],"orderBy":[{"direction":"asc","name":"CreatedDate"}],"partitionBy":["ParentId"]},"sources":["join(ForecastingItemHistory,ForecastingItem,Period)"]},"NormalizeForecastAmount":{"action":"computeExpression","parameters":{"computedFields":[{"format":"yyyy-MM-dd","label":"Date","name":"Date","saqlExpression":"toDate(AsOfDate_FirstDay, \"yyyy-MM-dd\")","type":"Date"},{"label":"Value","name":"Value","precision":18,"saqlExpression":"ForecastAmount_hst","scale":5,"type":"Numeric"},{"label":"Type","name":"Type","saqlExpression":"\"ForecastAmount\"","type":"Text"},{"label":"Period_ID","name":"Period_ID","saqlExpression":"'Parent.PeriodId'","type":"Text"},{"label":"ForecastingType_ID","name":"ForecastingType_ID","saqlExpression":"'Parent.ForecastingTypeId'","type":"Text"},{"label":"Owner_ID","name":"Owner_ID","saqlExpression":"'Parent.OwnerId'","type":"Text"},{"label":"Category","name":"Category","saqlExpression":"'Parent.ForecastingItemCategory'","type":"Text"},{"label":"ValueHigherBound","name":"ValueHigherBound","precision":18,"saqlExpression":"ForecastAmount_hst","scale":5,"type":"Numeric"},{"label":"ValueLowerBound","name":"ValueLowerBound","precision":18,"saqlExpression":"ForecastAmount_hst","scale":5,"type":"Numeric"}],"mergeWithSource":false},"sources":["RemoveLastCreatedDateColumn_FirstDay"]},"Extract_UserRole":{"action":"sobjectDigest","parameters":{"fields":[{"name":"Id"},{"name":"ParentRoleId"},{"name":"ForecastUserId"}],"object":"UserRole"}},"PreparePredictionTrend":{"action":"computeExpression","parameters":{"computedFields":[{"format":"yyyy-MM-dd","label":"Date","name":"Date","saqlExpression":"toDate(AsOfDate, \"yyyy-MM-dd\")","type":"Date"},{"label":"Type","name":"Type","saqlExpression":"ForecastingPredictionTrendType","type":"Text"},{"label":"Period_ID","name":"Period_ID","saqlExpression":"PeriodId","type":"Text"},{"label":"Value","name":"Value","precision":18,"saqlExpression":"Amount","scale":5,"type":"Numeric"},{"label":"ForecastingType_ID","name":"ForecastingType_ID","saqlExpression":"ForecastingTypeId","type":"Text"},{"label":"Owner_ID","name":"Owner_ID","saqlExpression":"ForecastOwnerId","type":"Text"},{"label":"Category","name":"Category","saqlExpression":"ForecastingPredictionTrendType","type":"Text"},{"label":"ValueHigherBound","name":"ValueHigherBound","precision":18,"saqlExpression":"AmountHigherBound","scale":5,"type":"Numeric"},{"label":"ValueLowerBound","name":"ValueLowerBound","precision":18,"saqlExpression":"AmountLowerBound","scale":5,"type":"Numeric"}],"mergeWithSource":false},"sources":["Extract_ForecastingPredictionTrend"]},"NormalizeAmountWithoutManagerAdjustment":{"action":"computeExpression","parameters":{"computedFields":[{"format":"yyyy-MM-dd","label":"Date","name":"Date","saqlExpression":"toDate(AsOfDate_FirstDay, \"yyyy-MM-dd\")","type":"Date"},{"label":"Value","name":"Value","precision":18,"saqlExpression":"AmountWithoutManagerAdjustment_hst","scale":5,"type":"Numeric"},{"label":"Type","name":"Type","saqlExpression":"\"AmountWithoutManagerAdjustment\"","type":"Text"},{"label":"Period_ID","name":"Period_ID","saqlExpression":"'Parent.PeriodId'","type":"Text"},{"label":"ForecastingType_ID","name":"ForecastingType_ID","saqlExpression":"'Parent.ForecastingTypeId'","type":"Text"},{"label":"Owner_ID","name":"Owner_ID","saqlExpression":"'Parent.OwnerId'","type":"Text"},{"label":"Category","name":"Category","saqlExpression":"'Parent.ForecastingItemCategory'","type":"Text"},{"label":"ValueHigherBound","name":"ValueHigherBound","precision":18,"saqlExpression":"AmountWithoutManagerAdjustment_hst","scale":5,"type":"Numeric"},{"label":"ValueLowerBound","name":"ValueLowerBound","precision":18,"saqlExpression":"AmountWithoutManagerAdjustment_hst","scale":5,"type":"Numeric"}],"mergeWithSource":false},"sources":["RemoveLastCreatedDateColumn_FirstDay"]},"filterOutDaysBeforeHTEnablement_FirstDay":{"action":"filter","parameters":{"filter":"AsOfDate_FirstDay:R:2018-05-09"},"sources":["RemoveFirstCreatedDateColumn_FirstDay"]},"Extract_ForecastingType":{"action":"sobjectDigest","parameters":{"fields":[{"name":"Id"},{"name":"DeveloperName"},{"name":"MasterLabel"},{"name":"IsAmount"},{"name":"IsQuantity"},{"name":"IsActive"},{"name":"RoleType"},{"name":"HasProductFamily"}],"object":"ForecastingType","runtime":{"SFDCtoken":"SFDCtoken"}}}}}